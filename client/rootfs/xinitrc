#!/bin/bash
# LumaDesk Client X Session
# Starts window manager and Moonlight client

# Set up X environment
xset s off         # Disable screen saver
xset -dpms        # Disable DPMS (Energy Star) features
xset s noblank    # Don't blank the video device

# Start window manager
openbox &
WM_PID=$!

# Wait for window manager
sleep 2

# Start Moonlight client
echo "Starting Moonlight streaming client..."
echo "Connecting to Sunshine server: ${SUNSHINE_HOST}"

# Launch Moonlight in fullscreen
moonlight stream \
    --host "${SUNSHINE_HOST}" \
    --app "Desktop" \
    --video-codec auto \
    --audio-codec auto \
    --fullscreen \
    --quit-after-stream

# If Moonlight exits, restart it after a delay
while true; do
    echo "Moonlight client exited. Restarting in 5 seconds..."
    sleep 5

    moonlight stream \
        --host "${SUNSHINE_HOST}" \
        --app "Desktop" \
        --video-codec auto \
        --audio-codec auto \
        --fullscreen \
        --quit-after-stream
done
